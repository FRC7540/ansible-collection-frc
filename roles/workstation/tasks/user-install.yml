- name: install wpilib for each user
  block:
    - name: create wpilib directory
      file:
        path: "/home/{{ user }}/wpilib/{{ wpilib_version_major }}"
        state: directory
        recurse: true
        owner: "{{ user }}"
        group: "{{ user }}"
      register: wpilib_home
    - name: install wpilib
      ansible.builtin.unarchive:
        src: "{{ wpilib_installer_root }}/{{ wpilib_base }}/{{ wpilib_artifacts_archive }}"
        dest: "{{ wpilib_home.path }}"
        owner: "{{ user }}"
        group: "{{ user }}"
    - name: create vscode dirs
      file:
        path: "{{ wpilib_home.path }}/{{ item }}"
        state: directory
        recurse: true
        owner: "{{ user }}"
        group: "{{ user }}"
      loop:
        - "vscode/data/extensions"
        - "vscode/data/user-data/User"
    - name: install wpilib extensions
      wpilib_vscode_userconf:
        path: "{{ wpilib_home.path }}"
    - name: configured vscode
      ansible.builtin.template:
        src: "{{ item.src }}"
        dest: "{{ item.dest }}"
        owner: "{{ user }}"
        group: "{{ user }}"
        mode: "0664"
      loop:
        - src: settings.json.j2
          dest: "{{ wpilib_home.path }}/vscode/data/user-data/User/settings.json"
        - src: frccode.desktop.j2
          dest: "/home/{{ user }}/.local/share/applications/frccode.desktop"
